Robert Wang (UID: 01586140)

# Taxi Anomaly Detection

This repository contains code for detecting anomalous taxi trips such as detours and overcharging using supervised machine learning models.

The pipeline consists of four main steps:

1. **Data preprocessing** (`1.DataProcess.py`):  
   - Load raw taxi orders with anomaly labels.  
   - Construct cleaned feature tables (coordinates, distance, time, price, temporal indicators, etc.).  
   - Save processed data for downstream experiments.

2. **Model training and hyperparameter tuning** (`2.AbnormalitiesDetection.py`):  
   - Define input feature space and preprocessing (scaling and one-hot encoding).  
   - Train Decision Tree, SVM, and Isolation Forest models using stratified 5-fold cross-validation.  
   - Perform grid search over hyperparameters using PR-AUC as the selection criterion.  
   - Export cross-validation metrics and best parameters for each model family.

3. **Feature ablation analysis – single feature** (`2.AblationOneFeature.py`):  
   - Perform feature ablation experiments on the tuned SVM model by removing **one feature at a time** from the full feature set.  
   - For each single-feature ablation setting, compute cross-validation metrics including accuracy, precision, recall, F1-score, ROC-AUC, and PR-AUC.  
   - Export a summary CSV for further analysis and for inclusion in the report.

4. **Feature ablation analysis – two-feature combinations** (`4.AblationTwoFeatures.py`):  
   - Based on the results of the single-feature ablation in Step 3, select a subset of important features and perform ablation experiments by removing **two features at a time** (pairwise ablation) from the tuned SVM model.  
   - For each two-feature ablation setting, compute cross-validation metrics including accuracy, precision, recall, F1-score, ROC-AUC, and PR-AUC.  
   - Export a summary CSV for further analysis and for inclusion in the report.

4. **Result visualization** (`5.Visualizationn.py`):  
   - Plot bar charts comparing F1-score, recall, and PR-AUC across models.  
   - Plot precision–recall curves and ROC curves for the tuned models.  
   - Plot confusion matrices and score distributions for the final SVM detector.  
   - Plot precision@K and recall@K curves for top-ranked trips.



## Repository structure

```text
taxi-anomaly-detection/
├── 1.DataProcess.py
│   # Data preprocessing:
│   # - Load raw taxi orders with anomaly labels
│   # - Construct cleaned feature table (coords, distance, time, price, temporal indicators, etc.)
│   # - Save processed data for downstream experiments
│
├── 2.AbnormalitiesDetection.py
│   # Model training & hyperparameter tuning:
│   # - Define input feature space and preprocessing (scaling, one-hot encoding)
│   # - Train Decision Tree, SVM, Isolation Forest with stratified 5-fold CV
│   # - Grid search using PR-AUC as selection criterion
│   # - Export CV metrics and best params for each model family
│
├── 3.AblationOneFeature.py
│   # Feature ablation – single feature:
│   # - Remove ONE feature at a time from the tuned SVM feature set
│   # - For each ablation setting, compute Accuracy / Precision / Recall /
│   #   F1-score / ROC-AUC / PR-AUC via cross-validation
│   # - Export a summary CSV for analysis and reporting
│
├── 4.AblationTwoFeatures.py
│   # Feature ablation – two-feature combinations:
│   # - Based on single-feature ablation results, select important features
│   # - Remove TWO features at a time (pairwise ablation) on the tuned SVM
│   # - For each setting, compute Accuracy / Precision / Recall /
│   #   F1-score / ROC-AUC / PR-AUC via cross-validation
│   # - Export a summary CSV for analysis and reporting
│
└── 5.Visualization.py
|   # Result visualization:
|   # - Plot bar charts comparing F1-score, recall, PR-AUC across models
|   # - Plot PR curves and ROC curves for tuned models
|   # - Plot confusion matrices and score distributions for the final SVM
|   # - Plot precision@K and recall@K curves for top-ranked trips
├── data/
│   ├── raw_taxi_orders_with_labels.csv
│   │   # Raw taxi order data with labels.
│   └── processed/
│       └── taxi_orders_with_labels/
│           # Processed data generated by 1.DataProcess.py
├── results/
│   ├── cv_metrics/
│   │   └── tuned_cv_metrics.csv  # Processed data generated by 2.AbnormalitiesDetection.py
│   ├── anomaly_ablation_svm.csv  # Processed data generated by 4.AblationTwoFeatures.py
│   ├── fig_pr_curves.png
│   ├── fig_roc_curves.png
│   ├── fig_svm_confusion_matrix.png
│   ├── fig_svm_score_distribution.png
│   ├── fig_svm_threshold_curve.png
│   ├── fig_topk_precision.png
│   └── fig_topk_recall.png   # All figures are generated by 5.Visualizationn.py
├── README.md
├── requirements.txt
├── .gitignore
└── LICENSE

