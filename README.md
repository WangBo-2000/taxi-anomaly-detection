# Taxi Anomaly Detection

This repository contains code for detecting anomalous taxi trips such as detours and overcharging using supervised machine learning models.

The pipeline consists of four main steps:

1. **Data preprocessing** (`1.DataProcess.py`):  
   - Load raw taxi orders with anomaly labels.  
   - Construct cleaned feature tables (coordinates, distance, time, price, temporal indicators, etc.).  
   - Save processed data for downstream experiments.

2. **Model training and hyperparameter tuning** (`2.AbnormalitiesDetection.py`):  
   - Define input feature space and preprocessing (scaling and one-hot encoding).  
   - Train Decision Tree, SVM, and Isolation Forest models using stratified 5-fold cross-validation.  
   - Perform grid search over hyperparameters using PR-AUC as the selection criterion.  
   - Export cross-validation metrics and best parameters for each model family.

3. **Result visualization** (`3.Visualizationn.py`):  
   - Plot bar charts comparing F1-score, recall, and PR-AUC across models.  
   - Plot precision–recall curves and ROC curves for the tuned models.  
   - Plot confusion matrices and score distributions for the final SVM detector.  
   - Plot precision@K and recall@K curves for top-ranked trips.

4. **Feature ablation analysis** (`4.Ablation.py`):  
   - Perform feature ablation experiments on the tuned SVM model.  
   - For each ablation setting, compute cross-validation metrics such as accuracy, precision, recall, F1-score, ROC-AUC, and PR-AUC.  
   - Export a summary CSV for further analysis and for inclusion in the report.

## Repository structure

```text
taxi-anomaly-detection/
├── 1.DataProcess.py
├── 2.AbnormalitiesDetection.py
├── 3.Visualizationn.py
├── 4.Ablation.py
├── data/
│   ├── raw_taxi_orders_with_labels.csv
│   │   # Raw taxi order data with labels.
│   └── processed/
│       └── taxi_orders_with_labels/
│           # Processed data generated by 1.DataProcess.py
├── results/
│   ├── cv_metrics/
│   │   └── tuned_cv_metrics.csv  # Processed data generated by 2.AbnormalitiesDetection.py
│   ├── anomaly_ablation_svm.csv  # Processed data generated by 4.Ablation.py
│   ├── fig_bar_metrics_cv.png
│   ├── fig_pr_curves.png
│   ├── fig_roc_curves.png
│   ├── fig_svm_confusion_matrix.png
│   ├── fig_svm_score_distribution.png
│   ├── fig_svm_threshold_curve.png
│   ├── fig_topk_precision.png
│   └── fig_topk_recall.png   # All figures are generated by 3.Visualizationn.py
├── README.md
├── requirements.txt
├── .gitignore
└── LICENSE

